<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hexo"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hexo"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Zongbao Chen"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Hexo","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Zongbao Chen"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="2071806038533702" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/schedule">Schedule</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-10-17T01:50:01.463Z" title="2024/10/17 09:50:01">2024-10-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-17T06:04:09.530Z" title="2024/10/17 14:04:09">2024-10-17</time></span><span class="level-item"><a class="link-muted" href="/categories/Hexo/">Hexo</a></span><span class="level-item">a minute read (About 123 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/10/17/hello-world/">Hello World</a></p><div class="content"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-07-06T16:00:00.000Z" title="2020/7/7 00:00:00">2020-07-07</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-17T06:15:16.902Z" title="2024/10/17 14:15:16">2024-10-17</time></span><span class="level-item"> Wayne Wang </span><span class="level-item"><a class="link-muted" href="/categories/Hexo/">Hexo</a></span><span class="level-item">35 minutes read (About 5210 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/07/07/Steve%20Jobs/">Steve</a></p><div class="content"><h1 id="FluidX3D-Documentation-How-to-get-started"><a href="#FluidX3D-Documentation-How-to-get-started" class="headerlink" title="FluidX3D Documentation - How to get started?"></a>FluidX3D Documentation - How to get started?</h1><h2 id="0-Install-GPU-Drivers-and-OpenCL-Runtime"><a href="#0-Install-GPU-Drivers-and-OpenCL-Runtime" class="headerlink" title="0. Install GPU Drivers and OpenCL Runtime"></a>0. Install GPU Drivers and OpenCL Runtime</h2><details><summary>(click to expand section)</summary>

<ul>
<li><p><strong>Windows</strong></p>
<details><summary>GPUs</summary>

<ul>
<li>Download and install the <a target="_blank" rel="noopener" href="https://www.amd.com/en/support/download/drivers.html">AMD</a>&#x2F;<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/download/785597/intel-arc-iris-xe-graphics-windows.html">Intel</a>&#x2F;<a target="_blank" rel="noopener" href="https://www.nvidia.com/Download/index.aspx">Nvidia</a> GPU Drivers, which contain the OpenCL Runtime.</li>
<li>Reboot.</li>
</ul>
</details>
<details><summary>CPUs</summary>

<ul>
<li>Download and install the <a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-cpu-runtime-for-opencl-applications-with-sycl-support.html">Intel CPU Runtime for OpenCL</a> (works for both AMD&#x2F;Intel CPUs).</li>
<li>Reboot.</li>
</ul>
</details>
</li>
<li><p><strong>Linux</strong></p>
<details><summary>AMD GPUs</summary>

<ul>
<li>Download and install <a target="_blank" rel="noopener" href="https://www.amd.com/en/support/linux-drivers">AMD GPU Drivers</a>, which contain the OpenCL Runtime, with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y g++ git make ocl-icd-libopencl1 ocl-icd-opencl-dev</span><br><span class="line"><span class="built_in">mkdir</span> -p ~/amdgpu</span><br><span class="line">wget -P ~/amdgpu https://repo.radeon.com/amdgpu-install/6.1.3/ubuntu/jammy/amdgpu-install_6.1.60103-1_all.deb</span><br><span class="line"><span class="built_in">sudo</span> apt install -y ~/amdgpu/amdgpu-install*.deb</span><br><span class="line"><span class="built_in">sudo</span> amdgpu-install -y --usecase=graphics,rocm,opencl --opencl=rocr</span><br><span class="line"><span class="built_in">sudo</span> usermod -a -G render,video $(<span class="built_in">whoami</span>)</span><br><span class="line"><span class="built_in">rm</span> -r ~/amdgpu</span><br><span class="line"><span class="built_in">sudo</span> shutdown -r now</span><br></pre></td></tr></table></figure></li>
</ul>
</details>
<details><summary>Intel GPUs</summary>

<ul>
<li>Intel GPU Drivers come already installed since Linux Kernel 6.2, but they don’t contain the OpenCL Runtime.</li>
<li>The the <a target="_blank" rel="noopener" href="https://github.com/intel/compute-runtime/releases">OpenCL Runtime</a> has to be installed separately with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y g++ git make ocl-icd-libopencl1 ocl-icd-opencl-dev intel-opencl-icd</span><br><span class="line"><span class="built_in">sudo</span> usermod -a -G render $(<span class="built_in">whoami</span>)</span><br><span class="line"><span class="built_in">sudo</span> shutdown -r now</span><br></pre></td></tr></table></figure></li>
</ul>
</details>
<details><summary>Nvidia GPUs</summary>

<ul>
<li>Download and install <a target="_blank" rel="noopener" href="https://www.nvidia.com/Download/index.aspx">Nvidia GPU Drivers</a>, which contain the OpenCL Runtime, with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y g++ git make ocl-icd-libopencl1 ocl-icd-opencl-dev nvidia-driver-550</span><br><span class="line"><span class="built_in">sudo</span> shutdown -r now</span><br></pre></td></tr></table></figure></li>
</ul>
</details>
<details><summary>CPUs</summary>

<ul>
<li>Option 1: Download and install the <a target="_blank" rel="noopener" href="https://github.com/intel/llvm/releases?q=oneAPI+DPC+++Compiler">oneAPI DPC++ Compiler</a> and <a target="_blank" rel="noopener" href="https://github.com/oneapi-src/oneTBB/releases">oneTBB</a> with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> OCLV=<span class="string">&quot;2024.18.6.0.02_rel&quot;</span></span><br><span class="line"><span class="built_in">export</span> TBBV=<span class="string">&quot;2021.13.0&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y g++ git make ocl-icd-libopencl1 ocl-icd-opencl-dev</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p ~/cpurt /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span> /etc/OpenCL/vendors /etc/ld.so.conf.d</span><br><span class="line"><span class="built_in">sudo</span> wget -P ~/cpurt https://github.com/intel/llvm/releases/download/2024-WW25/oclcpuexp-<span class="variable">$&#123;OCLV&#125;</span>.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> wget -P ~/cpurt https://github.com/oneapi-src/oneTBB/releases/download/v<span class="variable">$&#123;TBBV&#125;</span>/oneapi-tbb-<span class="variable">$&#123;TBBV&#125;</span>-lin.tgz</span><br><span class="line"><span class="built_in">sudo</span> tar -zxvf ~/cpurt/oclcpuexp-<span class="variable">$&#123;OCLV&#125;</span>.tar.gz -C /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span></span><br><span class="line"><span class="built_in">sudo</span> tar -zxvf ~/cpurt/oneapi-tbb-<span class="variable">$&#123;TBBV&#125;</span>-lin.tgz -C /opt/intel</span><br><span class="line"><span class="built_in">echo</span> /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span>/x64/libintelocl.so | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/OpenCL/vendors/intel_expcpu.icd</span><br><span class="line"><span class="built_in">echo</span> /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span>/x64 | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/ld.so.conf.d/libintelopenclexp.conf</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -sf /opt/intel/oneapi-tbb-<span class="variable">$&#123;TBBV&#125;</span>/lib/intel64/gcc4.8/libtbb.so /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span>/x64</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -sf /opt/intel/oneapi-tbb-<span class="variable">$&#123;TBBV&#125;</span>/lib/intel64/gcc4.8/libtbbmalloc.so /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span>/x64</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -sf /opt/intel/oneapi-tbb-<span class="variable">$&#123;TBBV&#125;</span>/lib/intel64/gcc4.8/libtbb.so.12 /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span>/x64</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -sf /opt/intel/oneapi-tbb-<span class="variable">$&#123;TBBV&#125;</span>/lib/intel64/gcc4.8/libtbbmalloc.so.2 /opt/intel/oclcpuexp_<span class="variable">$&#123;OCLV&#125;</span>/x64</span><br><span class="line"><span class="built_in">sudo</span> ldconfig -f /etc/ld.so.conf.d/libintelopenclexp.conf</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -r ~/cpurt</span><br></pre></td></tr></table></figure></li>
<li>Option 2: Download and install <a target="_blank" rel="noopener" href="https://portablecl.org/">PoCL</a> with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br><span class="line"><span class="built_in">sudo</span> apt install -y g++ git make ocl-icd-libopencl1 ocl-icd-opencl-dev pocl-opencl-icd</span><br></pre></td></tr></table></figure>
</details></li>
</ul>
</li>
<li><p><strong>Android</strong></p>
<details><summary>ARM GPUs</summary>

<ul>
<li>Download the <a target="_blank" rel="noopener" href="https://github.com/termux/termux-app/releases">Termux <code>.apk</code></a> and install it.</li>
<li>In the Termux app, run:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt upgrade -y</span><br><span class="line">apt install -y clang git make</span><br></pre></td></tr></table></figure></li>
</ul>
</details></li>
</ul>
</details>

<br>

<h2 id="1-Download-FluidX3D"><a href="#1-Download-FluidX3D" class="headerlink" title="1. Download FluidX3D"></a>1. Download FluidX3D</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ProjectPhysX/FluidX3D/archive/refs/heads/master.zip">Download</a> and unzip the source code, or clone with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ProjectPhysX/FluidX3D.git &amp;&amp; <span class="built_in">cd</span> FluidX3D</span><br></pre></td></tr></table></figure></li>
<li>To update FluidX3D:<ul>
<li>Make a backup of your changes.</li>
<li>Run:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br><span class="line">git pull origin master</span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<br>

<h2 id="2-Compiling-the-Source-Code"><a href="#2-Compiling-the-Source-Code" class="headerlink" title="2. Compiling the Source Code"></a>2. Compiling the Source Code</h2><ul>
<li>There is no “installation” of FluidX3D. Instead, you have to compile the source code yourself.</li>
<li>I have made this as easy as possible and this documentation will guide you through it. Nontheless, some basic programming experience with C++ would be good for the setup scripts.</li>
<li>First, compile the code as-is; this is the standard FP32 benchmark test case. By default, the fastest installed GPU will be selected automatically. Compile time is about 5 seconds.</li>
</ul>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul>
<li>Download and install <a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/de/vs/community/">Visual Studio Community</a>. In Visual Studio Installer, add:<ul>
<li>Desktop development with C++</li>
<li>MSVC v142</li>
<li>Windows 10 SDK</li>
</ul>
</li>
<li>Open <a href="FluidX3D.sln"><code>FluidX3D.sln</code></a> in <a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/de/vs/community/">Visual Studio Community</a>.</li>
<li>Compile and run by clicking the <kbd>► Local Windows Debugger</kbd> button.</li>
<li>To select a specific GPU, open Windows CMD in the <code>FluidX3D</code> folder (type <code>cmd</code> in File Explorer in the directory field and press <kbd>Enter</kbd>), then run <code>bin\FluidX3D.exe 0</code> to select device <code>0</code>. You can also select multiple GPUs with <code>bin\FluidX3D.exe 0 1 3 6</code> if the setup is <a href="#the-lbm-class">configured as multi-GPU</a>.</li>
</ul>
<h3 id="Linux-macOS-Android"><a href="#Linux-macOS-Android" class="headerlink" title="Linux &#x2F; macOS &#x2F; Android"></a>Linux &#x2F; macOS &#x2F; Android</h3><ul>
<li>Compile and run with:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x make.sh</span><br><span class="line">./make.sh</span><br></pre></td></tr></table></figure></li>
<li>Compiling requires <a target="_blank" rel="noopener" href="https://gcc.gnu.org/"><code>g++</code></a> with <code>C++17</code>, which is supported since version <code>8</code> (check with <code>g++ --version</code>). If you have <a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/"><code>make</code></a> installed (check with <code>make --version</code>), compiling will will be faster using multiple CPU cores; otherwise compiling falls back to using a single CPU core.</li>
<li>To select a specific GPU, enter <code>./make.sh 0</code> to compile+run, or <code>bin/FluidX3D 0</code> to run on device <code>0</code>. You can also select multiple GPUs with <code>bin/FluidX3D 0 1 3 6</code> if the setup is <a href="#the-lbm-class">configured as multi-GPU</a>.</li>
<li>Operating system (Linux&#x2F;macOS&#x2F;Android) and X11 support (required for <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS</code></a>) are detected automatically. In case problems arise, you can still manually select <a href="make.sh#L13"><code>target=...</code></a> in <a href="make.sh#L13"><code>make.sh</code></a>.</li>
<li>On macOS and Android, <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS</code></a> mode is not supported, as no X11 is available. You can still use <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS_ASCII</code></a> though, or <a href="#video-rendering">render video</a> to the hard drive with regular <a href="src/defines.hpp"><code>GRAPHICS</code></a> mode.</li>
</ul>
<br>

<h2 id="3-Go-through-Sample-Setups"><a href="#3-Go-through-Sample-Setups" class="headerlink" title="3. Go through Sample Setups"></a>3. Go through Sample Setups</h2><ul>
<li>Now open <a href="src/setup.cpp"><code>src/setup.cpp</code></a>. In here are all the sample setups, each one being a <code>void main_setup() &#123;...&#125;</code> function block written in C++. Uncomment one of them, maybe start top-to-bottom.</li>
<li>In the line where the <code>main_setup()</code> function starts, it says “required extensions in defines.hpp:”, followed by a list of extensions in capital letters. Head over to <a href="src/defines.hpp"><code>src/defines.hpp</code></a> and comment out<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#define BENCHMARK</span></span><br></pre></td></tr></table></figure>
with a <code>//</code>. Then, uncomment all of the extensions required for the setup by removing the <code>//</code> in front of the corresponding line.</li>
<li>Finally, <a href="#2-compiling-the-source-code">compile</a> and run the setup with the <kbd>► Local Windows Debugger</kbd> button (Windows) or <code>./make.sh</code> (Linux&#x2F;macOS&#x2F;Android).</li>
<li>Once the interactive graphics window opens, press key <kbd>P</kbd> to start&#x2F;pause the simulation, and press <kbd>H</kbd> to show the help menu for keyboard controls and visualization settings.</li>
<li>Go through some of the sample setups this way, get familiar with their code structure and test the graphics mode.</li>
</ul>
<br>

<h2 id="4-Keyboard-Mouse-Controls-for-INTERACTIVE-GRAPHICS-ASCII"><a href="#4-Keyboard-Mouse-Controls-for-INTERACTIVE-GRAPHICS-ASCII" class="headerlink" title="4. Keyboard&#x2F;Mouse Controls for INTERACTIVE_GRAPHICS&#x2F;_ASCII"></a>4. Keyboard&#x2F;Mouse Controls for <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS</code></a>&#x2F;<a href="src/defines.hpp"><code>_ASCII</code></a></h2><table>
<thead>
<tr>
<th align="center">Key</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody><tr>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="center"><kbd>P</kbd></td>
<td align="left">start&#x2F;pause the simulation</td>
</tr>
<tr>
<td align="center"><kbd>H</kbd></td>
<td align="left">show&#x2F;hide help menu for keyboard controls and visualization settings</td>
</tr>
<tr>
<td align="center"><kbd>Esc</kbd><br><kbd>Alt</kbd>+<kbd>F4</kbd></td>
<td align="left">quit</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="center"><kbd>Mouse</kbd><br><kbd>I</kbd><br><kbd>J</kbd> <kbd>K</kbd> <kbd>L</kbd></td>
<td align="left">rotate camera</td>
</tr>
<tr>
<td align="center"><kbd>Scrollwheel</kbd><br><kbd>+</kbd> <kbd>-</kbd></td>
<td align="left">zoom (centered camera mode) or camera movement speed (free camera mode)</td>
</tr>
<tr>
<td align="center"><kbd>Mouseclick</kbd><br><kbd>U</kbd></td>
<td align="left">toggle rotation with <kbd>Mouse</kbd> and angle snap rotation with <kbd>I</kbd> <kbd>J</kbd> <kbd>K</kbd> <kbd>L</kbd></td>
</tr>
<tr>
<td align="center"><kbd>F</kbd></td>
<td align="left">toggle centered&#x2F;free camera mode</td>
</tr>
<tr>
<td align="center"><kbd>W</kbd><br><kbd>A</kbd> <kbd>S</kbd> <kbd>D</kbd><br><kbd>Space</kbd> <kbd>C</kbd></td>
<td align="left">move free camera</td>
</tr>
<tr>
<td align="center"><kbd>Y</kbd> <kbd>X</kbd></td>
<td align="left">adjust camera field of view</td>
</tr>
<tr>
<td align="center"><kbd>R</kbd></td>
<td align="left">toggle camera autorotation</td>
</tr>
<tr>
<td align="center"><kbd>G</kbd></td>
<td align="left">print current camera position&#x2F;rotation in console as copy&#x2F;paste command</td>
</tr>
<tr>
<td align="center"><kbd>V</kbd></td>
<td align="left">toggle stereoscopic rendering for VR</td>
</tr>
<tr>
<td align="center"><kbd>B</kbd></td>
<td align="left">toggle VR-goggles&#x2F;3D-TV mode for stereoscopic rendering</td>
</tr>
<tr>
<td align="center"><kbd>N</kbd> <kbd>M</kbd></td>
<td align="left">adjust eye distance for stereoscopic rendering</td>
</tr>
<tr>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="center"><kbd>1</kbd></td>
<td align="left">flag wireframe &#x2F; solid surface (and force vectors on solid cells or surface pressure if the extension is used)</td>
</tr>
<tr>
<td align="center"><kbd>2</kbd></td>
<td align="left">velocity field</td>
</tr>
<tr>
<td align="center"><kbd>3</kbd></td>
<td align="left">streamlines</td>
</tr>
<tr>
<td align="center"><kbd>4</kbd></td>
<td align="left">vorticity (velocity-colored Q-criterion isosurface)</td>
</tr>
<tr>
<td align="center"><kbd>5</kbd></td>
<td align="left">rasterized free surface</td>
</tr>
<tr>
<td align="center"><kbd>6</kbd></td>
<td align="left">raytraced free surface</td>
</tr>
<tr>
<td align="center"><kbd>7</kbd></td>
<td align="left">particles</td>
</tr>
<tr>
<td align="center"><kbd>T</kbd></td>
<td align="left">toggle slice visualization mode</td>
</tr>
<tr>
<td align="center"><kbd>Z</kbd></td>
<td align="left">toggle field visualization mode</td>
</tr>
<tr>
<td align="center"><kbd>Q</kbd> <kbd>E</kbd></td>
<td align="left">move slice in slice visualization mode</td>
</tr>
</tbody></table>
<br>

<h2 id="5-Writing-your-own-Setups"><a href="#5-Writing-your-own-Setups" class="headerlink" title="5. Writing your own Setups"></a>5. Writing your own Setups</h2><h3 id="The-LBM-Class"><a href="#The-LBM-Class" class="headerlink" title="The LBM Class"></a>The LBM Class</h3><ul>
<li>For initializing the simulation box, use call<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(Nx, Ny, Nz, nu, ...)</span>;</span><br></pre></td></tr></table></figure>
constructor. <code>Nx</code>&#x2F;<code>Ny</code>&#x2F;<code>Nz</code> is the grid resolution and <code>nu</code> is the kinematic shear viscosity in <a href="#unit-conversion">LBM units</a>.</li>
<li>To use multiple GPUs, use<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(Nx, Ny, Nz, Dx, Dy, Dz, nu, ...)</span>;</span><br></pre></td></tr></table></figure>
with <code>Dx</code>&#x2F;<code>Dy</code>&#x2F;<code>Dz</code> indicating how many domains (GPUs) there are in each spatial direction. The product <code>Dx</code>×<code>Dy</code>×<code>Dz</code> is the total number of domains (GPUs).</li>
<li>As long as the <code>lbm</code> object is in scope, you can access the memory. As soon as it goes out of scope, all memory associated with the current simulation is freed again.</li>
<li>The grid resolution <code>Nx</code>&#x2F;<code>Ny</code>&#x2F;<code>Nz</code> ultimately determines the VRAM occupation. Quite often it’s not obvious at which resolution you’ll overshoot the VRAM capacity of the GPU(s). To aid with this, there is the function:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> uint3 lbm_N = resolution(float3(<span class="number">1.0f</span>, <span class="number">2.0f</span>, <span class="number">0.5f</span>), <span class="number">2000u</span>);</span><br></pre></td></tr></table></figure>
This takes as inputs the desired aspect ratio of the simulation box and the VRAM occupation in MB, and returns the grid resolution as a <code>uint3</code> with <code>.x</code>&#x2F;<code>.y</code>&#x2F;<code>.z</code> components. You can also directly feed the <code>uint3</code> into the LBM constructor as resolution:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(lbm_N, nu, ...)</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Unit-Conversion"><a href="#Unit-Conversion" class="headerlink" title="Unit Conversion"></a>Unit Conversion</h3><ul>
<li>The LBM simulation uses a different unit system from SI units, where density <code>rho=1</code> and velocity <code>u≈0.001-0.1</code>, because floating-point arithmetic is most accurate close to <code>1</code>.</li>
<li>To ease unit conversion from SI to LBM units and back, there is the <a href="src/units.hpp"><code>units.hpp</code></a> struct. By calling<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">units.set_m_kg_s(lbm_length, lbm_velocity, lbm_density=<span class="number">1</span>, si_length, si_velocity, si_density);</span><br></pre></td></tr></table></figure>
the base unit conversion factors [m], [kg], [s] are calculated and stored in the <code>units</code> struct. Thereafter, any of the conversion functions from <a href="src/units.hpp"><code>src/units.hpp</code></a> can be used to go from SI to LBM units and back, such as <code>lbm_nu = units.nu(si_nu)</code> to convert the kinematic viscosity from SI to LBM units.</li>
<li>A good beginner example for this is the “<a href="src/setup.cpp">aerodynamics of a cow</a>“ setup.</li>
</ul>
<h3 id="Initial-and-Boundary-Conditions"><a href="#Initial-and-Boundary-Conditions" class="headerlink" title="Initial and Boundary Conditions"></a>Initial and Boundary Conditions</h3><ul>
<li>If not explicitly set, by default all cells have the default values <code>rho=1</code>, <code>u=0</code>, <code>flags=0</code>.</li>
<li>The initial&#x2F;boundary conditions of single grid cells are set in a parallelized loop that iterates over the entire grid:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> uint Nx=lbm.get_Nx(), Ny=lbm.get_Ny(), Nz=lbm.get_Nz(); parallel_for(lbm.get_N(), [&amp;](ulong n) &#123; uint x=<span class="number">0u</span>, y=<span class="number">0u</span>, z=<span class="number">0u</span>; lbm.coordinates(n, x, y, z);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
Within this loop, you can set the density, velocity and flags of each cell individually by assigning values to <code>lbm.rho[n]</code>, <code>lbm.u.x[n]</code>, <code>lbm.u.y[n]</code>, <code>lbm.u.z[n]</code> and <code>lbm.flags[n]</code>. The <code>n</code> here is the linearized 3D grid index, corresponding to an (<code>x</code>|<code>y</code>|<code>z</code>) position via the function <code>lbm.coordinates(n, x, y, z)</code>.</li>
<li>For example, to set solid walls at the left and right sides of the simulation box, write<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(y==<span class="number">0u</span>||y==Ny<span class="number">-1u</span>) lbm.flags[n] = TYPE_S;</span><br></pre></td></tr></table></figure>
within the loop.</li>
<li>All box sides where no solid (<code>TYPE_S</code>) or other boundary type are set will remain periodic boundaries.</li>
<li>Primitive geometry, such as spheres, ellipsoids, cubes, cuboids, cylinders, codes, pipes, triangles, inclined planes, or toruses can be set with the functions from <a href="src/shapes.hpp"><code>shapes.hpp</code></a>. Example to insert a cylinder:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(cylinder(x, y, z, lbm.center(), float3(axis_x, axis_z, axis_z), radius) lbm.flags[n] = TYPE_S;</span><br></pre></td></tr></table></figure></li>
<li>The non-moving no-slip mid-grid bounce-back boundaries (<code>TYPE_S</code>) are always available without further extensions. “No-slip bounce-back” refers to the property that the flow velocity directly at the boundary is 0 (no-slip condition). “Mid-grid” refers to the boundary being located exactly in the middle between the boundary cells and adjacent fluid cells.</li>
<li>For inflow&#x2F;outflow boundaries, you need to enable (uncomment) the <a href="src/defines.hpp"><code>EQUILIBRIUM_BOUNDARIES</code></a> extension. Then, for the specific inflow&#x2F;outflow cells, set the flag <code>lbm.flags[n] = TYPE_E</code> and on the same cell specify either a density <code>lbm.rho[n]</code> unequal to <code>1</code> or a velocity <code>lbm.u.x[n]</code>&#x2F;<code>lbm.u.y[n]</code>&#x2F;<code>lbm.u.z[n]</code> unequal to <code>0</code>, or a combination of both. <code>TYPE_E</code> cells enforce the specified density&#x2F;velocity value and absorb any incoming shockwaves.</li>
<li>For moving solid boundaries, you need to enable (uncomment) the <a href="src/defines.hpp"><code>MOVING_BOUNDARIES</code></a> extension. Then, for the specific solid cells, set the flag <code>lbm.flags[n] = TYPE_S</code> and on the same cell specify a velocity <code>lbm.u.x[n]</code>&#x2F;<code>lbm.u.y[n]</code>&#x2F;<code>lbm.u.z[n]</code> unequal to <code>0</code>. <code>TYPE_S</code> cells reflect any incoming shockwaves.</li>
<li>If strict mass conservation is required (for example flow through a linear pipe), use periodic boundaries (i.e. don’t set any boundary type on the cells at these simulation box sides), and drive the flow with a volume force (equivalent to a pressure gradient). Therefore you need to enable (uncomment) the <a href="src/defines.hpp"><code>VOLUME_FORCE</code></a> extension, and in the <a href="#the-lbm-class">LBM constuctor</a> set the force per volume (<code>fx</code>|<code>fy</code>|<code>fz</code>):<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(Nx, Ny, Nz, nu, fx, fy, fz)</span>;</span><br></pre></td></tr></table></figure>
These force per volume values should not exceed <code>0.001</code> in magnitude.</li>
</ul>
<h3 id="Running-the-Simulation"><a href="#Running-the-Simulation" class="headerlink" title="Running the Simulation"></a>Running the Simulation</h3><ul>
<li>Call <code>lbm.run()</code> (without input parameter, it’s infinite time steps) to initialize and execute the setup, or <code>lbm.run(time_steps)</code> to execute only a specific number of time steps.</li>
<li>If you have a <a href="#video-rendering">more complicated simulation loop</a> where you periodically compute time steps and render images for a video or export data, don’t forget to place an <code>lbm.run(0u)</code> before that loop. This copies the initial&#x2F;boundary conditions from CPU RAM to GPU VRAM and initializes the simulation on the GPU, without computing a time step. Without initialization, there is no data in VRAM yet for rendering.</li>
</ul>
<h3 id="Loading-stl-Files"><a href="#Loading-stl-Files" class="headerlink" title="Loading .stl Files"></a>Loading .stl Files</h3><ul>
<li>For more complex geometries, you can load <code>.stl</code> triangle meshes and voxelize them to the Cartesian simulation grid on the GPU(s).</li>
<li>Create a <code>FluidX3D/stl/</code> folder next to the <code>FluidX3D/src/</code> folder and download the geometry from websites like <a target="_blank" rel="noopener" href="https://www.thingiverse.com/">Thingiverse</a>, or create your own.</li>
<li>Only binary <code>.stl</code> files are supported. For conversion from other formats or for splitting composite geometries like helicopter hull and rotors, I recommend <a target="_blank" rel="noopener" href="https://apps.microsoft.com/store/detail/3d-builder/9WZDNCRFJ3T6">Microsoft 3D Builder</a> on Windows or <a target="_blank" rel="noopener" href="https://www.blender.org/">Blender</a> on Windows&#x2F;Linux.</li>
<li>Load and voxelize simple <code>.stl</code> files directly with<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lbm.voxelize_stl(get_exe_path()+<span class="string">&quot;../stl/mesh.stl&quot;</span>, center, rotation, size);</span><br></pre></td></tr></table></figure>
This automatically repositions&#x2F;rescales the mesh to the specified center. Use <code>lbm.center()</code> for the simulation box center, or add an offset with a <code>+float3(offset_x, offset_y, offset_z)</code>. You can generate and multiply together a rotation matrix like this (example: rotation around the z-axis by 180°, then around the x-axis by 90°):<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float3x3 rotation = float3x3(float3(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), radians(<span class="number">90.0f</span>))*float3x3(float3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), radians(<span class="number">180.0f</span>));</span><br></pre></td></tr></table></figure></li>
<li>To load composite geometries with several parts without automatic mesh repositioning&#x2F;rescaling, use<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Mesh* mesh_1 = read_stl(<span class="type">const</span> <span class="built_in">string</span>&amp; path, <span class="type">const</span> <span class="type">float</span> scale=<span class="number">1.0f</span>, <span class="type">const</span> float3x3&amp; rotation=float3x3(<span class="number">1.0f</span>), <span class="type">const</span> float3&amp; offset=float3(<span class="number">0.0f</span>)); <span class="comment">// load mesh without automatic repositioning/rescaling</span></span><br><span class="line">Mesh* mesh_2 = read_stl(<span class="type">const</span> <span class="built_in">string</span>&amp; path, <span class="type">const</span> <span class="type">float</span> scale=<span class="number">1.0f</span>, <span class="type">const</span> float3x3&amp; rotation=float3x3(<span class="number">1.0f</span>), <span class="type">const</span> float3&amp; offset=float3(<span class="number">0.0f</span>));</span><br><span class="line">mesh_1-&gt;scale(<span class="type">const</span> <span class="type">float</span> scale); <span class="comment">// manually scale meshes</span></span><br><span class="line">mesh_2-&gt;scale(<span class="type">const</span> <span class="type">float</span> scale);</span><br><span class="line">mesh_1-&gt;translate(<span class="type">const</span> float3&amp; translation); <span class="comment">// manually reposition meshes</span></span><br><span class="line">mesh_2-&gt;translate(<span class="type">const</span> float3&amp; translation);</span><br><span class="line">lbm.voxelize_mesh_on_device(mesh_1); <span class="comment">// voxelize meshes on GPU</span></span><br><span class="line">lbm.voxelize_mesh_on_device(mesh_2);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
to load the meshes from the <code>.stl</code> files, manually scale&#x2F;reposition all parts of the mesh the same time, and finally voxelize them on the GPU.</li>
<li>To aid with repositioning the mesh, there is <code>lbm.center()</code> for the center of the simulation box, as well as the min&#x2F;max bounding-box coordinates of the mesh <code>mesh-&gt;pmin</code>&#x2F;<code>mesh-&gt;pmax</code>, each a <code>float3</code> with (<code>x</code>|<code>y</code>|<code>z</code>) components.</li>
<li>Rotating geometries have to be periodically revoxelized, about every 1-10 LBM time steps. In the main simulation loop in the <a href="src/setup.cpp"><code>main_setup()</code></a> function, first rotate the triangle mesh, then revoxelize on GPU, then compute a few LBM time steps:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> uint lbm_T = <span class="number">100000u</span>; <span class="comment">// number of LBM time steps to simulate</span></span><br><span class="line"><span class="type">const</span> uint lbm_dt = <span class="number">4u</span>; <span class="comment">// number of LBM time steps between each mesh revoxelization</span></span><br><span class="line">lbm.run(<span class="number">0u</span>); <span class="comment">// initialize simulation</span></span><br><span class="line"><span class="keyword">while</span>(lbm.<span class="type">get_t</span>()&lt;lbm_T) &#123; <span class="comment">// main simulation loop</span></span><br><span class="line">  mesh-&gt;rotate(float3x3(float3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>), lbm_omega*(<span class="type">float</span>)lbm_dt)); <span class="comment">// rotate the triangle mesh</span></span><br><span class="line">  lbm.voxelize_mesh_on_device(mesh, TYPE_S, center, float3(<span class="number">0.0f</span>), float3(<span class="number">0.0f</span>, <span class="number">0.0f</span>, lbm_omega)); <span class="comment">// revoxelize the rotated triangle mesh, provide the instantaneous angular velocity vector for moving boundaries</span></span><br><span class="line">  lbm.run(lbm_dt); <span class="comment">// run lbm_dt LBM time steps</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
Here <code>lbm_omega</code> is the angular velocity in radians per time step, <code>lbm_dt</code> is the number of simulated time steps between revoxelizations, and <code>float3(0.0f, 0.0f, lbm_omega)</code> is the instantaneous angular velocity as a vector along the axis of rotation. The largest displacement of the outermost cells should not exceed <code>1</code> cell between revoxelizations; set <code>lbm_omega = lbm_u/lbm_radius</code> accordingly.</li>
<li>Have a look at the “<a href="src/setup.cpp">Cessna 172</a>“ and “<a href="src/setup.cpp">Bell 222</a>“ setups for some examples.</li>
</ul>
<h3 id="Video-Rendering"><a href="#Video-Rendering" class="headerlink" title="Video Rendering"></a>Video Rendering</h3><ul>
<li>For video rendering, disable (comment out) <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS</code></a> and <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS_ASCII</code></a> and enable (uncomment) <a href="src/defines.hpp"><code>GRAPHICS</code></a> in <a href="src/defines.hpp"><code>src/defines.hpp</code></a>.</li>
<li>Set the video resolution as <a href="src/defines.hpp"><code>GRAPHICS_FRAME_WIDTH</code></a>&#x2F;<a href="src/defines.hpp"><code>GRAPHICS_FRAME_HEIGHT</code></a> and the background color as <a href="src/defines.hpp"><code>GRAPHICS_BACKGROUND_COLOR</code></a>. You can also adjust the other <a href="src/defines.hpp"><code>GRAPHICS_...</code></a> options there, such as semi-transparent rendering mode, or adjust the color scale for velocity with <a href="src/defines.hpp"><code>GRAPHICS_U_MAX</code></a>.</li>
<li>A basic loop for rendering video in the <a href="src/setup.cpp"><code>main_setup()</code></a> function looks like this:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lbm.graphics.visualization_modes = VIS_FLAG_LATTICE|VIS_Q_CRITERION; <span class="comment">// set visualization modes, see all available visualization mode macros (VIZ_...) in defines.hpp</span></span><br><span class="line"><span class="type">const</span> uint lbm_T = <span class="number">10000u</span>; <span class="comment">// number of LBM time steps to simulate</span></span><br><span class="line">lbm.run(<span class="number">0u</span>, lbm_T); <span class="comment">// initialize simulation</span></span><br><span class="line"><span class="keyword">while</span>(lbm.<span class="type">get_t</span>()&lt;lbm_T) &#123; <span class="comment">// main simulation loop</span></span><br><span class="line">  <span class="keyword">if</span>(lbm.graphics.next_frame(lbm_T, <span class="number">25.0f</span>)) &#123; <span class="comment">// render enough frames for 25 seconds of 60fps video</span></span><br><span class="line">    lbm.graphics.set_camera_free(float3(<span class="number">2.5f</span>*(<span class="type">float</span>)Nx, <span class="number">0.0f</span>*(<span class="type">float</span>)Ny, <span class="number">0.0f</span>*(<span class="type">float</span>)Nz), <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">50.0f</span>); <span class="comment">// set camera to position 1</span></span><br><span class="line">    lbm.graphics.write_frame(get_exe_path()+<span class="string">&quot;export/camera_1/&quot;</span>); <span class="comment">// export image from camera position 1</span></span><br><span class="line">    lbm.graphics.set_camera_centered(<span class="number">-40.0f</span>, <span class="number">20.0f</span>, <span class="number">78.0f</span>, <span class="number">1.25f</span>); <span class="comment">// set camera to position 2</span></span><br><span class="line">    lbm.graphics.write_frame(get_exe_path()+<span class="string">&quot;export/camera_2/&quot;</span>); <span class="comment">// export image from camera position 2</span></span><br><span class="line">  &#125;</span><br><span class="line">  lbm.run(<span class="number">1u</span>, lbm_T); <span class="comment">// run 1 LBM time step</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>To find suitable camera placement, run the simulation at low resolution in <a href="src/defines.hpp"><code>INTERACTIVE_GRAPHICS</code></a> mode, rotate&#x2F;move the camera to the desired position, click the <kbd>Mouse</kbd> to disable mouse rotation, and press <kbd>G</kbd> to print the current camera settings as a copy-paste command in the console. <kbd>Alt</kbd>+<kbd>Tab</kbd> to the console and copy the camera placement command by selecting it with the mouse and right-clicking, then paste it into the <a href="src/setup.cpp"><code>main_setup()</code></a> function.</li>
<li>To fly the camera along a smooth path through a list of provided keyframe camera placements, use <code>catmull_rom</code> splines:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(lbm.<span class="type">get_t</span>()&lt;=lbm_T) &#123; <span class="comment">// main simulation loop</span></span><br><span class="line">  <span class="keyword">if</span>(lbm.graphics.next_frame(lbm_T, <span class="number">30.0f</span>)) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> t = (<span class="type">float</span>)lbm.<span class="type">get_t</span>()/(<span class="type">float</span>)lbm_T;</span><br><span class="line">    <span class="built_in">vector</span>&lt;float3&gt; camera_positions = &#123;</span><br><span class="line">      float3(<span class="number">-0.282220f</span>*(<span class="type">float</span>)Nx,  <span class="number">0.529221f</span>*(<span class="type">float</span>)Ny,  <span class="number">0.304399f</span>*(<span class="type">float</span>)Nz),</span><br><span class="line">      float3( <span class="number">0.806921f</span>*(<span class="type">float</span>)Nx,  <span class="number">0.239912f</span>*(<span class="type">float</span>)Ny,  <span class="number">0.436880f</span>*(<span class="type">float</span>)Nz),</span><br><span class="line">      float3( <span class="number">1.129724f</span>*(<span class="type">float</span>)Nx, <span class="number">-0.130721f</span>*(<span class="type">float</span>)Ny,  <span class="number">0.352759f</span>*(<span class="type">float</span>)Nz),</span><br><span class="line">      float3( <span class="number">0.595601f</span>*(<span class="type">float</span>)Nx, <span class="number">-0.504690f</span>*(<span class="type">float</span>)Ny,  <span class="number">0.203096f</span>*(<span class="type">float</span>)Nz),</span><br><span class="line">      float3(<span class="number">-0.056776f</span>*(<span class="type">float</span>)Nx, <span class="number">-0.591919f</span>*(<span class="type">float</span>)Ny, <span class="number">-0.416467f</span>*(<span class="type">float</span>)Nz)</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">float</span>&gt; camera_rx = &#123;</span><br><span class="line">       <span class="number">116.0f</span>,</span><br><span class="line">        <span class="number">25.4f</span>,</span><br><span class="line">       <span class="number">-10.6f</span>,</span><br><span class="line">       <span class="number">-45.6f</span>,</span><br><span class="line">       <span class="number">-94.6f</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">float</span>&gt; camera_ry = &#123;</span><br><span class="line">        <span class="number">26.0f</span>,</span><br><span class="line">        <span class="number">33.3f</span>,</span><br><span class="line">        <span class="number">20.3f</span>,</span><br><span class="line">        <span class="number">25.3f</span>,</span><br><span class="line">       <span class="number">-16.7f</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> camera_fov = <span class="number">90.0f</span>;</span><br><span class="line">    lbm.graphics.set_camera_free(catmull_rom(camera_positions, t), catmull_rom(camera_rx, t), catmull_rom(camera_ry, t), camera_fov);</span><br><span class="line">    lbm.graphics.write_frame(get_exe_path()+<span class="string">&quot;export/&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  lbm.run(<span class="number">1u</span>, lbm_T);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>The visualization mode(s) can be specified as <code>lbm.graphics.visualization_modes</code> with the <a href="src/defines.hpp"><code>VIS_...</code></a> macros. You can also set the <code>lbm.graphics.slice_mode</code> (<code>0</code>&#x3D;no slice, <code>1</code>&#x3D;x, <code>2</code>&#x3D;y, <code>3</code>&#x3D;z, <code>4</code>&#x3D;xz, <code>5</code>&#x3D;xyz, <code>6</code>&#x3D;yz, <code>7</code>&#x3D;xy) and reposition the slices with <code>lbm.graphics.slice_x</code>&#x2F;<code>lbm.graphics.slice_y</code>&#x2F;<code>lbm.graphics.slice_z</code>.</li>
<li>Exported frames will automatically be assigned the current simulation time step in their name, in the format <code>bin/export/image-123456789.png</code>.</li>
<li>To convert the rendered <code>.png</code> images to video, use <a target="_blank" rel="noopener" href="https://ffmpeg.org/">FFmpeg</a>:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -framerate 60 -pattern_type glob -i <span class="string">&quot;export/*/image-*.png&quot;</span> -c:v libx264 -pix_fmt yuv420p -b:v 24M <span class="string">&quot;video.mp4&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Data-Export"><a href="#Data-Export" class="headerlink" title="Data Export"></a>Data Export</h3><ul>
<li>At any point in time, you can export volumetric data as binary <code>.vtk</code> files with:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lbm.rho.write_device_to_vtk(); <span class="comment">// density</span></span><br><span class="line">lbm.u.write_device_to_vtk(); <span class="comment">// velocity</span></span><br><span class="line">lbm.flags.write_device_to_vtk(); <span class="comment">// flags</span></span><br><span class="line">lbm.F.write_device_to_vtk(); <span class="comment">// force, only for FORCE_FIELD extension</span></span><br><span class="line">lbm.phi.write_device_to_vtk(); <span class="comment">// fill fraction, only for SURFACE extension</span></span><br><span class="line">lbm.T.write_device_to_vtk(); <span class="comment">// temperature, only for TEMPERATURE extension</span></span><br><span class="line">lbm.write_mesh_to_vtk(<span class="type">const</span> Mesh* mesh); <span class="comment">// for exporting triangle meshes</span></span><br></pre></td></tr></table></figure></li>
<li>These functions first pull the data from the GPU(s) into CPU RAM, and then write it to the hard drive.</li>
<li>If <a href="#unit-conversion">unit conversion</a> with <code>units.set_m_kg_s(...)</code> was specified, the data in exported <code>.vtk</code> files is automaticlally converted to SI units.</li>
<li>Exported files will automatically be assigned the current simulation time step in their name, in the format <code>bin/export/u-123456789.vtk</code>.</li>
<li>Be aware that these volumetric files can be gigantic in file size, tens of GigaByte for a single file.</li>
<li>You can view&#x2F;evaluate the <code>.vtk</code> files for example in <a target="_blank" rel="noopener" href="https://www.paraview.org/">ParaView</a>.</li>
<li>It is recommended to use the C++ functionality in the <a href="src/setup.cpp"><code>main_setup()</code></a> function directly to extract the data of interest and selectively only write that to the hard drive. Therefore, call <code>lbm.u.read_from_device()</code> to copy the data from the GPU(s) to CPU RAM, and then you can access it directly, for example<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">float</span> lbm_velocity_x = lbm.u.x[lbm.index(x, y, z)];</span><br></pre></td></tr></table></figure>
to get the x-velocity at the position (<code>x</code>|<code>y</code>|<code>z</code>) in <a href="#unit-conversion">LBM units</a>.</li>
<li>To <a href="#unit-conversion">convert the velocity from LBM to SI units</a>, use<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">float</span> si_velocity_x = units.si_u(lbm_velocity_x);</span><br></pre></td></tr></table></figure>
after having done <a href="#unit-conversion">unit conversion</a> with <code>units.set_m_kg_s(...)</code>.</li>
<li>You can also export the <code>.stl</code> triangle meshes to binary <code>.vtk</code> files with:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lbm.write_mesh_to_vtk(<span class="type">const</span> Mesh* mesh);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Lift-Drag-Forces"><a href="#Lift-Drag-Forces" class="headerlink" title="Lift&#x2F;Drag Forces"></a>Lift&#x2F;Drag Forces</h3><ul>
<li>Enable (uncomment) the <a href="src/defines.hpp"><code>FORCE_FIELD</code></a> extension. This extension allows computing boundary forces on every solid cell (<code>TYPE_S</code>) individually, as well as placing an individual volume force on every fluid cell (not used here).</li>
<li>In the <a href="src/setup.cpp"><code>main_setup()</code></a> function’s main simulation loop, alternatingly call:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lbm.run(lbm_dt); <span class="comment">// run lbm_dt LBM time steps</span></span><br><span class="line">lbm.calculate_force_on_boundaries(); <span class="comment">// compute boundary forces on GPU on all solid cells (TYPE_S)</span></span><br></pre></td></tr></table></figure>
The latter computes the boundary forces on the GPU into the <code>lbm.F</code> field in VRAM.</li>
<li>To copy <code>lbm.F</code> from GPU VRAM to CPU RAM, call:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lbm.F.read_from_device();</span><br></pre></td></tr></table></figure>
You can then access the boundary forces at each individual cell with:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> lbm_force_x_n = lbm.F.x[lbm.index(x, y, z)];</span><br></pre></td></tr></table></figure></li>
<li>To sum over all the individual boundary cells that belong to the body, to get the total force on the body, first voxelize the body with<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lbm.voxelize_mesh_on_device(mesh, TYPE_S|TYPE_X);</span><br></pre></td></tr></table></figure>
with the additional <code>TYPE_X</code> flagging, and then call<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> float3 lbm_force = lbm.calculate_force_on_object(TYPE_S|TYPE_X);</span><br></pre></td></tr></table></figure>
to sum over all cells marked <code>TYPE_S|TYPE_X</code> that belong to the body. You can also use <code>TYPE_Y</code> for this.</li>
<li>Finally, <a href="#unit-conversion">convert from LBM to SI units</a> with<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">float</span> si_force_x = units.si_F(lbm_force.x);</span><br></pre></td></tr></table></figure>
after having done <a href="#unit-conversion">unit conversion</a> with <code>units.set_m_kg_s(...)</code>.</li>
<li>See the “Ahmed body” setup for an example. Note that in the highly turbulent regime, computed body forces are too large by up to a factor 2, because even large resolution is not enough to fully capture the turbulent boundary layer. A wall function is needed, I’ll scan literature on it.</li>
</ul>
<br>

<h2 id="6-Further-LBM-Extensions"><a href="#6-Further-LBM-Extensions" class="headerlink" title="6. Further LBM Extensions"></a>6. Further LBM Extensions</h2><p>By now you’re already familiar with the <a href="#initial-and-boundary-conditions">additional boundary types</a> through extensions <a href="src/defines.hpp"><code>VOLUME_FORCE</code></a>, <a href="src/defines.hpp"><code>FORCE_FIELD</code></a>, <a href="src/defines.hpp"><code>EQUILIBRIUM_BOUNDARIES</code></a>, and <a href="src/defines.hpp"><code>MOVING_BOUNDARIES</code></a>. The remaining available model extensions are briefly outlined here:</p>
<h3 id="SURFACE-Extension"><a href="#SURFACE-Extension" class="headerlink" title="SURFACE Extension"></a><a href="src/defines.hpp"><code>SURFACE</code></a> Extension</h3><ul>
<li>To simulate free water surfaces, enable (uncomment) the <a href="src/defines.hpp"><code>SURFACE</code></a> extension.</li>
<li>All cells then get 3 additional flags: <code>TYPE_F</code> (fluid), <code>TYPE_I</code> (interface), and <code>TYPE_G</code> (gas). Fluid cells are computed with regular LBM. Interface cells account for the extra surface tension forces, if the surface tension coefficient <code>sigma</code> is set greater than <code>0</code> in the <a href="#the-lbm-class">LBM constructor</a>; the interface is always 1 cell layer thick. Gas cells are not simulated at all and are essentially treated as vacuum.</li>
<li>If not set otherwise in the <a href="#initial-and-boundary-conditions">initial conditions</a>, all cells are initialized as <code>TYPE_G</code> by default. As initial conditions, set all cells that should be fluid to<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lbm.flags[n] = TYPE_F;</span><br></pre></td></tr></table></figure>
The interface layer will be automatically initialized during initialization with <code>lbm.run(0u)</code>.</li>
<li>Addidionally to the 3 flags, each cell also gets assigned a fill level <code>lbm.phi[n]</code>: <code>1</code> for fluid cells (<code>TYPE_F</code>), <code>]0,1[</code> for interface cells (<code>TYPE_I</code>), and <code>0</code> for gas cells (<code>TYPE_G</code>). You can set this fill level at initialization, additionally to the cell flag. Do not forget to set the cell flag. If <code>lbm.phi[n]</code> is not set manually, it will automatically be initialized such that all fluid cells get <code>phi=1</code>, all interface cells get <code>phi=0.5</code>, and all gas clls get <code>phi=0</code> assigned.</li>
<li>For a simple example, see the “<a href="src/setup.cpp">dam break</a>“ setup. A more advanced sample setup for free surfaces is the “<a href="src/setup.cpp">raindrop impact</a>“.</li>
</ul>
<h3 id="TEMPERATURE-Extension"><a href="#TEMPERATURE-Extension" class="headerlink" title="TEMPERATURE Extension"></a><a href="src/defines.hpp"><code>TEMPERATURE</code></a> Extension</h3><ul>
<li>With the <a href="src/defines.hpp"><code>TEMPERATURE</code></a> extension, FluidX3D can model thermal convection flows. This extension automatically also enables the <a href="src/defines.hpp"><code>VOLUME_FORCE</code></a> extension.</li>
<li>In the <a href="#the-lbm-class">LBM constructor</a>, you then need to set the volume force (<code>fx</code>|<code>fy</code>|<code>fz</code>), the thermal diffusion coefficient <code>alpha</code>, and the thermal expansion coefficient <code>beta</code>, all <a href="#unit-conversion">in LBM units</a>:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(Nx, Ny, Nz, nu, fx, fy, fz, <span class="number">0.0f</span>, alpha, beta)</span>; <span class="comment">// the &quot;0.0f&quot; is for the surface tension coefficient sigma which is not used here and has to remain 0</span></span><br></pre></td></tr></table></figure></li>
<li>With the extension, each grid cell gets an additional temperature <code>lbm.T[n]</code> (<a href="#unit-conversion">in LBM units</a>) assigned. The default temperature in LBM units is <code>1</code>.</li>
<li>To set temperature boundary conditions, use the flag <code>TYPE_T</code> and for the same cells assign a temperature unequal to <code>1</code>:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lbm.flags[n] = TYPE_T; <span class="comment">// make the cell n a temperature boundary</span></span><br><span class="line">lbm.T[n] = <span class="number">1.2f</span>; <span class="comment">// set this temperature boundary hotter than average</span></span><br></pre></td></tr></table></figure></li>
<li>See the “<a href="src/setup.cpp">Rayleigh-Benard convection</a>“ and “<a href="src/setup.cpp">thermal convection</a>“ setups for two examples.</li>
</ul>
<h3 id="SUBGRID-Extension"><a href="#SUBGRID-Extension" class="headerlink" title="SUBGRID Extension"></a><a href="src/defines.hpp"><code>SUBGRID</code></a> Extension</h3><ul>
<li>Fluid flow is characterized by the Reynolds number<p align="center"><i>Re</i> &#x3D; <sup><i>x</i>·<i>u</i></sup>&#8725;<sub><i>nu</i></sub></p>with a characteristic length scale <code>x</code>, a characteristic velocity <code>u</code> and the kinematic shear viscosity <code>nu</code>. Larger length scale, larger velocity or smaller viscosity all mean larger Reynolds number.</li>
<li>The Reynolds number is a unit-less number. A low value <i>Re</i> &lt; 2300 means laminar flow, a high value <i>Re</i> &gt; 2900 means turbulent flow. In between is a transitional regime.</li>
<li>For very large Reynolds number <i>Re</i> &gt; 100000, the LBM solver becomes <a href="#7-suitable-parameters-and-simulation-instability">unstable</a>, as tiny, very fast rotating vortices can be present in the flow field, and too fast velocity and shear rate makes the simulation blow up.</li>
<li>To tackle this problem, there is subgrid models that model vortices smaller than single grid cells. This works by increasing the effective vscosity where the shear rate is large and lots of small eddies are assumed to be present. Coincidentally, locations of high shear rate and low viscosity cause instability, so increasing effective viscosity there keeps the simulation stable.</li>
<li>The subgrid model in FLuidX3D is the Smagorinsky-Lilly model. You can enable it with the <a href="src/defines.hpp"><code>SUBGRID</code></a> extension.</li>
<li>There is no additional performance cost for this extension.</li>
</ul>
<h3 id="PARTICLES-Extension"><a href="#PARTICLES-Extension" class="headerlink" title="PARTICLES Extension"></a><a href="src/defines.hpp"><code>PARTICLES</code></a> Extension</h3><ul>
<li>By default, the LBM is a grid-based simulation, so there are no particles.</li>
<li>But the <a href="src/defines.hpp"><code>PARTICLES</code></a> extension allows to add particles to the simulation, either as passive tracers or as 2-way-coupled particles that can do floating&#x2F;sedimentation.</li>
<li>For passive tracers, only enable the <a href="src/defines.hpp"><code>PARTICLES</code></a> extension, and in the <a href="#the-lbm-class">LBM constructor</a> simply add the particle count:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(Nx, Ny, Nz, nu, <span class="number">50000u</span>)</span>; <span class="comment">// this will create 50000 particles</span></span><br></pre></td></tr></table></figure></li>
<li>Then, in <a href="#initial-and-boundary-conditions">initialization</a>, make a loop over all particles (outside of the initialization loop that iterates over all grid cells):<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uint seed = <span class="number">42u</span>;</span><br><span class="line"><span class="keyword">for</span>(ulong n=<span class="number">0ull</span>; n&lt;lbm.particles-&gt;length(); n++) &#123;</span><br><span class="line">  lbm.particles-&gt;x[n] = random_symmetric(seed, <span class="number">0.5f</span>*lbm.size().x); <span class="comment">// this will palce the particles randomly anywhere in the simulation box</span></span><br><span class="line">  lbm.particles-&gt;y[n] = random_symmetric(seed, <span class="number">0.5f</span>*lbm.size().y);</span><br><span class="line">  lbm.particles-&gt;z[n] = random_symmetric(seed, <span class="number">0.5f</span>*lbm.size().z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Note that the position (<code>0</code>|<code>0</code>|<code>0</code>) for particles corresponds to the simulation box center.</li>
<li>For 2-way-coupled particles, additionally enable the <a href="src/defines.hpp"><code>VOLUME_FORCE</code></a> and <a href="src/defines.hpp"><code>FORCE_FIELD</code></a> extensions, and in the <a href="#the-lbm-class">LBM constructor</a> add the particle density (<a href="#unit-conversion">in LBM units</a>) unequal to <code>1</code>:<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LBM <span class="title function_">lbm</span><span class="params">(Nx, Ny, Nz, nu, <span class="number">50000u</span>, <span class="number">1.2f</span>)</span>; <span class="comment">// this will create 50000 particles that are more dense than the fluid and will sink to the bottom</span></span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="7-Suitable-Parameters-and-Simulation-Instability"><a href="#7-Suitable-Parameters-and-Simulation-Instability" class="headerlink" title="7. Suitable Parameters and Simulation Instability"></a>7. Suitable Parameters and Simulation Instability</h2><ul>
<li>Sometimes in the velocity field or streamlines visualization, you will see fuzzyness, or something that looks like a rapidly growing white crystal, blowing up from a certain point and filling the entire simulation box. This is instability, i.e. when velocities turn <code>NaN</code> or <code>Inf</code>.</li>
<li>Often times, the cause of instability is an unfortunate choice of unsuitable parameters:<ul>
<li>too high&#x2F;low density <code>rho</code> (ideally should be very close to <code>1</code> at all times)</li>
<li>too high velocity <code>u</code> (must never exceed <code>0.57</code> anywhere in the box, ideally should be somewhere around <code>0.075</code>, but can be as small as <code>0.001</code>)</li>
<li>too low kinematic shear viscosity <code>nu</code> (ideally close to <code>1/6</code>, becomes unstable when it’s very very close to <code>0</code> (then enable the <a href="src/defines.hpp"><code>SUBGRID</code></a> extension), and should not exceed <code>3</code>)</li>
<li>too high force per volume (<code>fx</code>|<code>fy</code>|<code>fz</code>) (should not exceed <code>0.001</code> in magnitude)</li>
<li>too high surface tension coefficient <code>sigma</code> (should not exceed <code>0.1</code>)</li>
</ul>
</li>
<li>The best parametrization for LBM simulations is an art in itself and needs some practice.</li>
</ul>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Zongbao Chen"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Zongbao Chen</p><p class="is-size-6 is-block">Doctoral Student</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Category</p><a href="/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">2</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Hexo/"><span class="level-start"><span class="level-item">Hexo</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-10-17T01:50:01.463Z">2024-10-17</time></p><p class="title"><a href="/2024/10/17/hello-world/">Hello World</a></p><p class="categories"><a href="/categories/Hexo/">Hexo</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-07-06T16:00:00.000Z">2020-07-07</time></p><p class="title"><a href="/2020/07/07/Steve%20Jobs/">Steve</a></p><p class="categories"><a href="/categories/Hexo/">Hexo</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/blog/"><span class="tag">blog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="adsense"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="2071806038533702" data-ad-slot="f08c47fec0942fa0" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2024 Zongbao Chen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p><p class="is-size-7">© 2024</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>